# Rack.CopyFiles

## Что это такое?

Rack.CopyFiles — это консольное приложение для копирования файлов, полученных в результате компиляции модулей, в директорию оболочки. Необходимость копирования файлов обусловлена тем, что решение, содержащее проект-оболочку Rack, не имеет зависимостей от модулей. Наоборот, модули могут зависеть от оболочки. Данный подход, заключающийся в инверсии зависимостей, обладает как рядом преимуществ (модули разрабатываются независимо друг от друга, хранятся в отдельных репозиториях), так и недостатками (решение, содержащее оболочку, ничего не знает о модулях, поэтому MSBuild в ходе построения оболочки не может самостоятельно их скопировать в выходную директорию. По этой же причине для развёртывания программного комплекса применяется не ClickOnce, а Squirrel).

## Как это использовать?

Как правило, Rack.CopyFiles вызывается при успешном построении модулей из post-build events, а также при развёртывании приложения в TeamCity. Самый простой вариант использования приложения:

```
"$(SolutionDir)..\..\Shell\Rack.CopyFiles\$(OutDir)Rack.CopyFiles.exe" -m "$(ProjectDir)$(OutDir)\" -s "$(SolutionDir)..\..\Shell\Rack\$(OutDir)\"
```

"$(SolutionDir)..\..\Shell\Rack.CopyFiles\$(OutDir)Rack.CopyFiles.exe" — путь к исполняемому файлу.

### Аргументы

*Обязательные:*

- -m, --module: путь к скомпилированным файлам модуля;
- -s, --shell: путь к скомпилированным файлам оболочки.

*Необязательные:*

- -n, --module-name: название модуля. Этот параметр необходимо задать, если название модуля/решения не начинается с Rack (например, не "Rack.Chemistry", а "Chemistry").
- --module-dll-name: название главной библиотеки модуля. Эта библиотека копируется в директорию Modules/. Аналогично --module-name, этот параметр необходимо задать, если название модуля/решения не начинается с Rack (например, не "Rack.Chemistry", а "Chemistry").
- -d, --subdirectories: дополнительные директории для копирования. Если модуль содержит директории с дополнительными файлами, их можно указать. Названия директорий разделяются запятой.
- -l, --locale-only: если true, то выполнится копирование только директории Localizations. Этот режим необходим для сборок с локализацией, от которых зависит проект-модуль.

## Зависимости

Решение использует NuGet-пакеты:

- CommandLineParser (https://github.com/commandlineparser/commandline): библиотека для простого взаимодействия с аргументами командной строки.

**ВАЖНО:** этот проект должен собираться раньше любого другого в решении, так как другие проекты могут использовать результат сборки для копирования файлов. Это достигается наличием зависимости Rack.Shared от Rack.CopyFiles.
